
async function loadMaster(){ const res = await fetch('data/siswa.json'); const data = await res.json(); const local = JSON.parse(localStorage.getItem('siswa_local') || 'null'); window.siswaData = local || data; renderSiswaList(); }
function renderSiswaList(){ const tbody = document.getElementById('siswa-body'); tbody.innerHTML=''; window.siswaData.forEach(s=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td>${s.no}</td><td>${s.nama}</td><td>${s.kelas}</td><td>${s.status||'aktif'}</td><td><button class="btn" onclick="markNonaktif(${s.no})">Tandai Keluar</button></td>`; tbody.appendChild(tr); }); }
function addSiswa(e){ e.preventDefault(); const nama = document.getElementById('p_nama').value.trim(); const kelas = document.getElementById('p_kelas').value.trim(); if(!nama||!kelas) return alert('Isi nama & kelas'); const no = (window.siswaData.length? window.siswaData[window.siswaData.length-1].no +1:1); const obj = {no, nama, kelas, status:'aktif'}; window.siswaData.push(obj); localStorage.setItem('siswa_local', JSON.stringify(window.siswaData)); renderSiswaList(); document.getElementById('formPendaftaran').reset(); alert('Siswa ditambahkan (tersimpan di browser). Untuk permanen edit data/siswa.json di repo.'); }
function markNonaktif(no){ if(!confirm('Yakin tandai siswa keluar?')) return; const idx = window.siswaData.findIndex(s=>s.no===no); if(idx===-1) return; window.siswaData[idx].status='nonaktif'; localStorage.setItem('siswa_local', JSON.stringify(window.siswaData)); renderSiswaList(); }
function downloadSiswaExcel(){ const rows=[['No','Nama','Kelas','Status']]; window.siswaData.forEach(s=> rows.push([s.no,s.nama,s.kelas,s.status||'aktif'])); const csv = rows.map(r=> r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n'); const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='siswa.csv'; a.click(); a.remove(); URL.revokeObjectURL(url); }
document.addEventListener('DOMContentLoaded', loadMaster);
